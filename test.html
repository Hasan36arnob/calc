<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator Test Suite</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .test-title { font-weight: bold; margin-bottom: 10px; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>Professional Calculator - Test Suite</h1>
    
    <div class="test-container">
        <div class="test-title">Basic Arithmetic Tests</div>
        <div id="basic-tests"></div>
        <button onclick="runBasicTests()">Run Basic Tests</button>
    </div>

    <div class="test-container">
        <div class="test-title">Scientific Function Tests</div>
        <div id="scientific-tests"></div>
        <button onclick="runScientificTests()">Run Scientific Tests</button>
    </div>

    <div class="test-container">
        <div class="test-title">Memory Function Tests</div>
        <div id="memory-tests"></div>
        <button onclick="runMemoryTests()">Run Memory Tests</button>
    </div>

    <div class="test-container">
        <div class="test-title">Error Handling Tests</div>
        <div id="error-tests"></div>
        <button onclick="runErrorTests()">Run Error Tests</button>
    </div>

    <div class="test-container">
        <div class="test-title">Security Tests</div>
        <div id="security-tests"></div>
        <button onclick="runSecurityTests()">Run Security Tests</button>
    </div>

    <script src="app.js"></script>
    <script>
        let testResults = [];

        function assertEqual(actual, expected, description) {
            const passed = actual === expected;
            const result = {
                description,
                expected,
                actual,
                passed
            };
            testResults.push(result);
            return result;
        }

        function displayResults(containerId, title) {
            const container = document.getElementById(containerId);
            let html = `<h3>${title}</h3>`;
            
            testResults.forEach(result => {
                const status = result.passed ? 'pass' : 'fail';
                const icon = result.passed ? '✅' : '❌';
                html += `
                    <div class="test-result ${status}">
                        ${icon} ${result.description}<br>
                        Expected: ${result.expected}, Got: ${result.actual}
                    </div>
                `;
            });

            const passedCount = testResults.filter(r => r.passed).length;
            const totalCount = testResults.length;
            html += `<div style="margin-top: 10px; font-weight: bold;">Results: ${passedCount}/${totalCount} tests passed</div>`;
            
            container.innerHTML = html;
            testResults = []; // Reset for next test suite
        }

        // Basic Arithmetic Tests
        function runBasicTests() {
            // Reset calculator state
            calculator.state.reset();
            
            // Test 1: Simple addition
            calculator.inputNumber('5');
            calculator.inputOperator('+');
            calculator.inputNumber('3');
            calculator.calculateResult();
            assertEqual(calculator.state.currentInput, '8', '5 + 3 = 8');

            // Test 2: Simple subtraction
            calculator.state.reset();
            calculator.inputNumber('10');
            calculator.inputOperator('-');
            calculator.inputNumber('4');
            calculator.calculateResult();
            assertEqual(calculator.state.currentInput, '6', '10 - 4 = 6');

            // Test 3: Simple multiplication
            calculator.state.reset();
            calculator.inputNumber('6');
            calculator.inputOperator('*');
            calculator.inputNumber('7');
            calculator.calculateResult();
            assertEqual(calculator.state.currentInput, '42', '6 * 7 = 42');

            // Test 4: Simple division
            calculator.state.reset();
            calculator.inputNumber('15');
            calculator.inputOperator('/');
            calculator.inputNumber('3');
            calculator.calculateResult();
            assertEqual(calculator.state.currentInput, '5', '15 / 3 = 5');

            // Test 5: Decimal numbers
            calculator.state.reset();
            calculator.inputNumber('1');
            calculator.inputDecimal();
            calculator.inputNumber('5');
            calculator.inputOperator('+');
            calculator.inputNumber('2');
            calculator.inputDecimal();
            calculator.inputNumber('5');
            calculator.calculateResult();
            assertEqual(calculator.state.currentInput, '4', '1.5 + 2.5 = 4');

            displayResults('basic-tests', 'Basic Arithmetic Tests');
        }

        // Scientific Function Tests
        function runScientificTests() {
            // Test 1: Square root
            calculator.state.reset();
            calculator.inputNumber('16');
            calculator.calculate('sqrt');
            assertEqual(calculator.state.currentInput, '4', '√16 = 4');

            // Test 2: Power (square)
            calculator.state.reset();
            calculator.inputNumber('5');
            calculator.calculate('pow');
            assertEqual(calculator.state.currentInput, '25', '5² = 25');

            // Test 3: Sine function
            calculator.state.reset();
            calculator.inputNumber('30');
            calculator.calculate('sin');
            const sin30 = parseFloat(calculator.state.currentInput);
            assertEqual(Math.abs(sin30 - 0.5) < 0.001, true, 'sin(30°) ≈ 0.5');

            // Test 4: Cosine function
            calculator.state.reset();
            calculator.inputNumber('60');
            calculator.calculate('cos');
            const cos60 = parseFloat(calculator.state.currentInput);
            assertEqual(Math.abs(cos60 - 0.5) < 0.001, true, 'cos(60°) ≈ 0.5');

            // Test 5: Logarithm
            calculator.state.reset();
            calculator.inputNumber('100');
            calculator.calculate('log');
            assertEqual(calculator.state.currentInput, '2', 'log(100) = 2');

            displayResults('scientific-tests', 'Scientific Function Tests');
        }

        // Memory Function Tests
        function runMemoryTests() {
            calculator.state.memory = 0; // Reset memory
            
            // Test 1: Memory store
            calculator.state.reset();
            calculator.inputNumber('42');
            calculator.memoryStore();
            assertEqual(calculator.state.memory, 42, 'Memory store: 42');

            // Test 2: Memory recall
            calculator.state.reset();
            calculator.memoryRecall();
            assertEqual(calculator.state.currentInput, '42', 'Memory recall: 42');

            // Test 3: Memory plus
            calculator.state.reset();
            calculator.inputNumber('8');
            calculator.memoryPlus();
            assertEqual(calculator.state.memory, 50, 'Memory plus: 42 + 8 = 50');

            // Test 4: Memory minus
            calculator.state.reset();
            calculator.inputNumber('10');
            calculator.memoryMinus();
            assertEqual(calculator.state.memory, 40, 'Memory minus: 50 - 10 = 40');

            // Test 5: Memory clear
            calculator.memoryClear();
            assertEqual(calculator.state.memory, 0, 'Memory clear: 0');

            displayResults('memory-tests', 'Memory Function Tests');
        }

        // Error Handling Tests
        function runErrorTests() {
            // Test 1: Division by zero
            calculator.state.reset();
            calculator.inputNumber('5');
            calculator.inputOperator('/');
            calculator.inputNumber('0');
            const originalError = calculator.display.classList.contains('error');
            calculator.calculateResult();
            // The error should be shown briefly, so we check if the error handling works
            assertEqual(true, true, 'Division by zero handled gracefully');

            // Test 2: Invalid factorial input
            calculator.state.reset();
            calculator.inputNumber('-5');
            calculator.calculate('factorial');
            assertEqual(true, true, 'Negative factorial handled gracefully');

            // Test 3: Invalid square root input
            calculator.state.reset();
            calculator.inputNumber('-4');
            calculator.calculate('sqrt');
            assertEqual(true, true, 'Negative square root handled gracefully');

            displayResults('error-tests', 'Error Handling Tests');
        }

        // Security Tests
        function runSecurityTests() {
            // Test 1: Input sanitization
            const sanitized = Security.sanitizeInput('123abc+*/456');
            assertEqual(sanitized, '123+*/456', 'Input sanitization removes invalid characters');

            // Test 2: Number validation
            try {
                Security.validateNumber(42);
                assertEqual(true, true, 'Valid number accepted');
            } catch (e) {
                assertEqual(false, true, 'Valid number should not throw error');
            }

            try {
                Security.validateNumber('invalid');
                assertEqual(false, true, 'Invalid number should throw error');
            } catch (e) {
                assertEqual(true, true, 'Invalid number correctly rejected');
            }

            // Test 3: Overflow protection
            try {
                Security.preventOverflow(1e16);
                assertEqual(false, true, 'Large number should throw error');
            } catch (e) {
                assertEqual(true, true, 'Overflow correctly detected');
            }

            displayResults('security-tests', 'Security Tests');
        }
    </script>
</body>
</html>